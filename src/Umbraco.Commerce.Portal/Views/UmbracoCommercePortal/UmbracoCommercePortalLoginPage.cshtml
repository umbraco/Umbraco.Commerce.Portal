@using Umbraco.Cms.Web.Website.Controllers
@using Umbraco.Commerce.Portal.Models
@using Umbraco.Commerce.Portal.Extensions

@inherits UmbracoViewPage
@{
    Layout = "UmbracoCommercePortalAuthLayout.cshtml";

    var registerPage = Model.GetPortalContainerPage(
        UmbracoCommercePortalConstants.ContentTypes.Aliases.PortalAuthPage,
        UmbracoCommercePortalConstants.ContentNodes.PortalAuthRegisterPageNodeName);
    var forgotPasswordPage = Model.GetPortalContainerPage(
        UmbracoCommercePortalConstants.ContentTypes.Aliases.PortalAuthPage,
        UmbracoCommercePortalConstants.ContentNodes.PortalAuthResetPasswordPageNodeName);
    var myAccountPage = Model.GetPortalContainerPage(
        UmbracoCommercePortalConstants.ContentTypes.Aliases.PortalAuthPage,
        UmbracoCommercePortalConstants.ContentTypes.Aliases.PortalMyAccountPage);

    Context.Request.Query.TryGetValue("returnUrl", out var returnUrl);

    var redirectUrl = !string.IsNullOrEmpty(returnUrl)
            ? returnUrl.ToString()
            : myAccountPage != null ? myAccountPage.Url() : "/";

    var loginModel = new LoginModel();
}

<h2 class="auth__title">Sign in to your account</h2>

@using (Html.BeginUmbracoForm("Login", "UmbracoCommercePortalSurface", new { @class = "auth__form" }))
{
    @Html.Hidden("loginModel.RedirectUrl", redirectUrl)

    <div class="auth__field">
        <label class="auth__label" asp-for="@loginModel.Email">Email address</label>
        <input class="auth__input" asp-for="@loginModel.Email" />
    </div>

    <div class="auth__field">
        <div class="auth__label-wrapper">
            <label class="auth__label" asp-for="@loginModel.Password">Password</label>
            <a class="auth__link auth__link--right" href="@(forgotPasswordPage != null ? forgotPasswordPage.Url() : "#")">Forgot password?</a>
        </div>
        <input class="auth__input" asp-for="@loginModel.Password" type="password" autocomplete="off" />
    </div>

    <div class="auth__field">
        <div class="auth__error">
            @Html.ValidationSummary()
        </div>
    </div>

    <button class="auth__button" type="submit">Sign in</button>
}

@await Html.PartialAsync($"{UmbracoCommercePortalConstants.UmbracoCommercePortalViewPath}/Partials/UmbracoCommercePortalSignUp.cshtml")
